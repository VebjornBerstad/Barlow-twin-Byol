schema: '2.0'
stages:
  fetch_audioset:
    cmd: ' python -m swarm.fetch_audioset --kaggle_dataset zfturbo/audioset --temp_dir
      ./temp/ --data_dir ./datasets/ '
    deps:
    - path: src/swarm/fetch_audioset.py
      md5: 573b5d7c464e90c1cfee579fc092ecdc
      size: 1170
  fetch_gtzan:
    cmd: ' rm -rf ./temp/gtzan/ ./datasets/gtzan_train_mel_split/ ./datasets/gtzan_val_mel_split/
      && python -m swarm.download.kaggle --kaggle_dataset andradaolteanu/gtzan-dataset-music-genre-classification
      --temp_dir ./temp/gtzan/ --output_dir ./temp/gtzan_wavs/ --unzip True && python
      -m swarm.preprocess.gtzan --input_dir ./temp/gtzan_wavs/ --output_dir_train
      ./datasets/gtzan_train_mel_split/ --output_dir_val ./datasets/gtzan_val_mel_split/
      && rm -rf ./temp/gtzan/ '
    deps:
    - path: src/swarm/configs/spectrograms.py
      md5: 9381b0183ede5a06007a9ef25918c8c6
      size: 715
    - path: src/swarm/download/kaggle.py
      md5: 90770559818f46d2f15eca8885cd0d79
      size: 2013
    - path: src/swarm/preprocess/gtzan.py
      md5: 3a77385d96826a5d71eaa70e3afd53bb
      size: 4157
    - path: src/swarm/preprocess/tools.py
      md5: 181fa4938c30358da3c641f40e7ddcc0
      size: 2317
    params:
      params.yaml:
        datasets.gtzan:
          train_val_split: 0.8
          segment_length_sec: 10.0
          hop_length_sec: 10.0
          num_classes: 10
        spectrogram:
          target_sample_rate: 16000
          n_mels: 64
          f_min: 60
          f_max: 7800
    outs:
    - path: ./datasets/gtzan_train_mel_split/
      md5: dedebac35a96eabd673745ca51f6607d.dir
      size: 614026019
      nfiles: 2389
    - path: ./datasets/gtzan_val_mel_split/
      md5: bfb2e324902cf9c9ef30a263dc9a6a56.dir
      size: 153956293
      nfiles: 599
  fetch_audioset_train:
    cmd: ' rm -rf ./datasets/audioset_train_mel_split/ ./datasets/audioset_metadata/
      && python -m swarm.download.kaggle --kaggle_dataset zfturbo/audioset --temp_dir
      ./temp/audioset_train/ --unzip False && python -m swarm.preprocess.audioset
      --input_zip ./temp/audioset_train/audioset.zip --output_dir_lms ./datasets/audioset_train_mel_split/
      --output_dir_metadata ./datasets/audioset_metadata/ --temp_dir ./temp/audioset_train/ '
    deps:
    - path: src/swarm/configs/spectrograms.py
      md5: 9381b0183ede5a06007a9ef25918c8c6
      size: 715
    - path: src/swarm/download/kaggle.py
      md5: 90770559818f46d2f15eca8885cd0d79
      size: 2013
    - path: src/swarm/preprocess/audioset.py
      md5: 6ebf01108a8e65a43fc4a80bb7208ed8
      size: 3472
    - path: src/swarm/preprocess/tools.py
      md5: 181fa4938c30358da3c641f40e7ddcc0
      size: 2317
    params:
      params.yaml:
        spectrogram:
          target_sample_rate: 16000
          n_mels: 64
          f_min: 60
          f_max: 7800
    outs:
    - path: ./datasets/audioset_metadata/class_labels_indices.csv
      md5: 68c0b5c199d6cc789852b144cc3ab500
      size: 14675
    - path: ./datasets/audioset_metadata/train.csv
      md5: ededd922be3267a2ef83457d5f252e95
      size: 948332
    - path: ./datasets/audioset_train_mel_split/
      md5: 63a51864fe2e9101a5d735dc0a67fb88.dir
      size: 5001004406
      nfiles: 19642
  train_barlow_twins:
    cmd: ' rm -f ./models/model.pth && python -m swarm.train --train_dir datasets/gtzan_train_mel_split
      --audio_dir datasets/audioset_train_mel_split --audioset_train_csv_path datasets/audioset_metadata/train.csv
      --audioset_class_labels_indices_csv_path datasets/audioset_metadata/class_labels_indices.csv
      --model_path ./models/model.pth '
    deps:
    - path: ./datasets/audioset_metadata/class_labels_indices.csv
      md5: 68c0b5c199d6cc789852b144cc3ab500
      size: 14675
    - path: ./datasets/audioset_metadata/train.csv
      md5: ededd922be3267a2ef83457d5f252e95
      size: 948332
    - path: ./datasets/audioset_train_mel_split/
      md5: 63a51864fe2e9101a5d735dc0a67fb88.dir
      size: 5001004406
      nfiles: 19642
    - path: ./datasets/gtzan_train_mel_split/
      md5: dedebac35a96eabd673745ca51f6607d.dir
      size: 614026019
      nfiles: 2389
    - path: src/swarm/augmentations.py
      md5: 85999353e945895b6633c1b9b07f7be4
      size: 6002
    - path: src/swarm/callbacks.py
      md5: 9dea383b577bd0bddc9b80795459fbfb
      size: 8858
    - path: src/swarm/configs/dataset_gtzan.py
      md5: 88c37a72253ef18c3a626afc3fe58dfa
      size: 743
    - path: src/swarm/datasets.py
      md5: 8c523875a754aff064fa4d7e52ca5029
      size: 5281
    - path: src/swarm/losses.py
      md5: 1e66d8c128325e8809c9e93efacb1b14
      size: 2100
    - path: src/swarm/models.py
      md5: 0dd10bd94c3f39be66fe84c3a020c48f
      size: 7745
    - path: src/swarm/train.py
      md5: 48211c4db410d489df8ebf4440147e2c
      size: 6670
    - path: src/swarm/utils.py
      md5: f9073087736419f6a4f6a0e0973dec60
      size: 10055
    params:
      params.yaml:
        augmentations:
          random_crop_width:
            target_frames: 96
          mixup:
            ratio: 0.243
            memory_size: 2048
          linear_fader:
            gain: 0.727
          random_resize_crop:
            crop_scale:
              min: 1.0
              max: 1.361
            freq_scale:
              min: 0.596
              max: 1.174
            time_scale:
              min: 0.901
              max: 1.462
        datasets.gtzan:
          train_val_split: 0.8
          segment_length_sec: 10.0
          hop_length_sec: 10.0
          num_classes: 10
        training:
          batch_size: 128
          val_split: 0.1
          lr: 1.642e-06
          xcorr_lambda: 1.033
          emb_dim_size: 1024
          early_stopping_patience: 10
          max_epochs: 50
    outs:
    - path: ./models/model.pth
      md5: b9f0b4908c651c165fb34fe1f10479a0
      size: 6777768
  eval_barlow_twins:
    cmd: ' rm -rf ./models/linear_eval_model.pth && python -m swarm.linear_eval --model_path
      ./models/model.pth --gtzan_path_train ./datasets/gtzan_train_mel_split --gtzan_path_test
      ./datasets/gtzan_val_mel_split --linear_eval_model_path ./models/linear_eval_model.pth '
    deps:
    - path: ./datasets/gtzan_train_mel_split/
      md5: dedebac35a96eabd673745ca51f6607d.dir
      size: 614026019
      nfiles: 2389
    - path: ./datasets/gtzan_val_mel_split/
      md5: bfb2e324902cf9c9ef30a263dc9a6a56.dir
      size: 153956293
      nfiles: 599
    - path: ./models/model.pth
      md5: 149254076d052f10187e6376823e9aa2
      size: 6777768
    - path: src/swarm/augmentations.py
      md5: 85999353e945895b6633c1b9b07f7be4
      size: 6002
    - path: src/swarm/configs/augmentations.py
      md5: 96b167624d74016a12e5a182c91d7d1c
      size: 1436
    - path: src/swarm/configs/training.py
      md5: 87a4355834e87ff8f89f695999b67bb0
      size: 934
    - path: src/swarm/datasets.py
      md5: 8c523875a754aff064fa4d7e52ca5029
      size: 5281
    - path: src/swarm/linear_eval.py
      md5: 1487a29fdb010d353ec2d70f72e52ae7
      size: 2605
    - path: src/swarm/losses.py
      md5: 1e66d8c128325e8809c9e93efacb1b14
      size: 2100
    - path: src/swarm/models.py
      md5: 0dd10bd94c3f39be66fe84c3a020c48f
      size: 7745
    - path: src/swarm/utils.py
      md5: f9073087736419f6a4f6a0e0973dec60
      size: 10055
    params:
      params.yaml:
        augmentations:
          random_crop_width:
            target_frames: 96
          mixup:
            ratio: 0.243
            memory_size: 2048
          linear_fader:
            gain: 0.727
          random_resize_crop:
            crop_scale:
              min: 1.0
              max: 1.361
            freq_scale:
              min: 0.596
              max: 1.174
            time_scale:
              min: 0.901
              max: 1.462
        datasets.gtzan:
          train_val_split: 0.8
          segment_length_sec: 10.0
          hop_length_sec: 10.0
          num_classes: 10
        training:
          batch_size: 128
          val_split: 0.1
          lr: 1.642e-06
          xcorr_lambda: 1.033
          emb_dim_size: 1024
          early_stopping_patience: 10
          max_epochs: 50
    outs:
    - path: ./models/linear_eval_model.pth
      md5: 54c83d65e9fe316425329f25001478da
      size: 43087
  train_linear_eval:
    cmd: ' rm -rf ./models/linear_eval_model.pth && python -m swarm.linear_eval --model_path
      ./models/model.pth --gtzan_path_train ./datasets/gtzan_train_mel_split --linear_eval_model_path
      ./models/linear_eval_model.pth '
    deps:
    - path: ./datasets/gtzan_train_mel_split/
      md5: dedebac35a96eabd673745ca51f6607d.dir
      size: 614026019
      nfiles: 2389
    - path: ./models/model.pth
      md5: b9f0b4908c651c165fb34fe1f10479a0
      size: 6777768
    - path: src/swarm/augmentations.py
      md5: 85999353e945895b6633c1b9b07f7be4
      size: 6002
    - path: src/swarm/configs/augmentations.py
      md5: 96b167624d74016a12e5a182c91d7d1c
      size: 1436
    - path: src/swarm/configs/training.py
      md5: 87a4355834e87ff8f89f695999b67bb0
      size: 934
    - path: src/swarm/datasets.py
      md5: 8c523875a754aff064fa4d7e52ca5029
      size: 5281
    - path: src/swarm/linear_eval.py
      md5: 6ee85ef995fd3d5f7da6b8550c1f9e14
      size: 2467
    - path: src/swarm/losses.py
      md5: 1e66d8c128325e8809c9e93efacb1b14
      size: 2100
    - path: src/swarm/models.py
      md5: 0dd10bd94c3f39be66fe84c3a020c48f
      size: 7745
    - path: src/swarm/utils.py
      md5: f9073087736419f6a4f6a0e0973dec60
      size: 10055
    params:
      params.yaml:
        augmentations:
          random_crop_width:
            target_frames: 96
          mixup:
            ratio: 0.243
            memory_size: 2048
          linear_fader:
            gain: 0.727
          random_resize_crop:
            crop_scale:
              min: 1.0
              max: 1.361
            freq_scale:
              min: 0.596
              max: 1.174
            time_scale:
              min: 0.901
              max: 1.462
        datasets.gtzan:
          train_val_split: 0.8
          segment_length_sec: 10.0
          hop_length_sec: 10.0
          num_classes: 10
        training:
          batch_size: 128
          val_split: 0.1
          lr: 1.642e-06
          xcorr_lambda: 1.033
          emb_dim_size: 1024
          early_stopping_patience: 10
          max_epochs: 50
    outs:
    - path: ./models/linear_eval_model.pth
      md5: 8c6865e4c857108be708a78673a17ae4
      size: 43087
